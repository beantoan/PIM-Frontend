<mat-progress-bar mode="indeterminate" *ngIf="isLoadingAggregates" class="app-progress-bar"></mat-progress-bar>

<mat-card class="mat-elevation-z0">
  <mat-card-content fxLayout="row" fxLayout.xs="column" fxLayoutAlign="space-between stretch">

    <h3>Thông tin đầu tư theo cổ phiếu</h3>

  </mat-card-content>
</mat-card>


<table mat-table multiTemplateDataRows
       [dataSource]="aggregates.content">

  <ng-container matColumnDef="stock">
    <th mat-header-cell *matHeaderCellDef rowspan="2"><h4>Mã</h4></th>
    <td mat-cell *matCellDef="let row">
      <b>{{row.stock.code}}</b>
    </td>

    <td mat-footer-cell *matFooterCellDef>
      <b>Tổng</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="buyColumns">
    <th mat-header-cell *matHeaderCellDef colspan="4"><h4>Giao dịch mua</h4></th>
  </ng-container>

  <ng-container matColumnDef="sellColumns">
    <th mat-header-cell *matHeaderCellDef colspan="5"><h4>Giao dịch bán</h4></th>
  </ng-container>

  <ng-container matColumnDef="holdColumns">
    <th mat-header-cell *matHeaderCellDef colspan="2"><h4>Đang giữ</h4></th>
  </ng-container>

  <ng-container matColumnDef="revenueColumns">
    <th mat-header-cell *matHeaderCellDef colspan="3"><h4>Lợi nhuận</h4></th>
  </ng-container>

  <ng-container matColumnDef="tradingTimeColumns">
    <th mat-header-cell *matHeaderCellDef [attr.colspan]="3"><h4>Chu kỳ đầu tư</h4></th>
  </ng-container>

  <ng-container matColumnDef="buyQuantity">
    <th mat-header-cell *matHeaderCellDef>KL</th>
    <td mat-cell *matCellDef="let row">{{row.buyQuantity | number}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="buyAvgPrice">
    <th mat-header-cell *matHeaderCellDef>Giá</th>
    <td mat-cell *matCellDef="let row">{{row.buyAvgPrice | number}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="buyFee">
    <th mat-header-cell *matHeaderCellDef>Phí</th>
    <td mat-cell *matCellDef="let row">{{row.buyFee | number}}</td>
    <td mat-footer-cell *matFooterCellDef>
      <b>{{investmentPeriodService.getTotalBuyFee(aggregates.content) | number}}</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="buyMoney">
    <th mat-header-cell *matHeaderCellDef>Vốn</th>
    <td mat-cell *matCellDef="let row">{{row.buyMoney | number}}</td>
    <td mat-footer-cell *matFooterCellDef>
      <b>{{investmentPeriodService.getTotalBuyMoney(aggregates.content) | number}}</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="sellQuantity">
    <th mat-header-cell *matHeaderCellDef>KL</th>
    <td mat-cell *matCellDef="let row">{{row.sellQuantity | number}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="sellAvgPrice">
    <th mat-header-cell *matHeaderCellDef>Giá</th>
    <td mat-cell *matCellDef="let row">{{row.sellAvgPrice | number}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="sellFee">
    <th mat-header-cell *matHeaderCellDef>Phí</th>
    <td mat-cell *matCellDef="let row">{{row.sellFee | number}}</td>
    <td mat-footer-cell *matFooterCellDef>
      <b>{{investmentPeriodService.getTotalSellFee(aggregates.content) | number}}</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="sellTax">
    <th mat-header-cell *matHeaderCellDef>Thuế</th>
    <td mat-cell *matCellDef="let row">{{row.sellTax | number}}</td>
    <td mat-footer-cell *matFooterCellDef>
      <b>{{investmentPeriodService.getTotalSellTax(aggregates.content) | number}}</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="sellMoney">
    <th mat-header-cell *matHeaderCellDef>Tiền</th>
    <td mat-cell *matCellDef="let row">{{row.sellMoney | number}}</td>
    <td mat-footer-cell *matFooterCellDef>
      <b>{{investmentPeriodService.getTotalSellMoney(aggregates.content) | number}}</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="holdQuantity">
    <th mat-header-cell *matHeaderCellDef>KL</th>
    <td mat-cell *matCellDef="let row">{{investmentPeriodService.calcHoldQuantity(row) | number}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="holdMoney">
    <th mat-header-cell *matHeaderCellDef>Tiền UT</th>
    <td mat-cell *matCellDef="let row">{{investmentPeriodService.calcHoldMoney(row) | number}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="netRevenue">
    <th mat-header-cell *matHeaderCellDef>Ròng</th>
    <td mat-cell *matCellDef="let row">{{investmentPeriodService.calcNetRevenue(row) | number}}</td>
    <td mat-footer-cell *matFooterCellDef>
      <b>{{investmentPeriodService.getTotalNetRevenue(aggregates.content) | number}}</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="grossRevenue">
    <th mat-header-cell *matHeaderCellDef>Gộp</th>
    <td mat-cell *matCellDef="let row">{{investmentPeriodService.calcGrossRevenue(row) | number}}</td>
    <td mat-footer-cell *matFooterCellDef>
      <b>{{investmentPeriodService.getTotalGrossRevenue(aggregates.content) | number}}</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="roiPercentage">
    <th mat-header-cell *matHeaderCellDef>ROI</th>
    <td mat-cell *matCellDef="let row">{{investmentPeriodService.calcROIPercentage(row) | number}}</td>
    <td mat-footer-cell *matFooterCellDef>
      <b>{{investmentPeriodService.getTotalROIPercentage(aggregates.content) | number}}</b>
    </td>
  </ng-container>

  <ng-container matColumnDef="startedOn">
    <th mat-header-cell *matHeaderCellDef>Bắt đầu</th>
    <td mat-cell *matCellDef="let row">{{row.startedOn | date}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="endedOn">
    <th mat-header-cell *matHeaderCellDef>Kết thúc</th>
    <td mat-cell *matCellDef="let row">{{row.endedOn | date}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="totalPeriod">
    <th mat-header-cell *matHeaderCellDef>Thời gian</th>
    <td mat-cell *matCellDef="let row">{{investmentPeriodService.calcTotalDays(row) | number}}</td>
    <td mat-footer-cell *matFooterCellDef></td>
  </ng-container>

  <ng-container matColumnDef="disclaimer">
    <td mat-footer-cell *matFooterCellDef [attr.colspan]="18">
      <ul>
        <li><b>Giá mua</b>/<b>giá bán</b> được tính giá trị trung bình trên toàn bộ giao dịch mua/bán của phiên đầu tư</li>
        <li><b>Tiền UT</b> được tính ước tính theo giá bán trung bình</li>
        <li><b>Lợi nhuận ròng</b> được tính theo khối lượng các giao dịch bán - phí giao dịch</li>
        <li><b>Lợi nhuận gộp</b> được tính bằng tiền bán - tiền vốn - phí giao dịch</li>
      </ul>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="calcDisplayedHeaderColumns()"></tr>

  <tr mat-header-row *matHeaderRowDef="calcDisplayedSubHeaderColumns(); sticky: true"></tr>

  <tr mat-row
      *matRowDef="let row; columns: calcDisplayedColumns();"
      class="investment-period-row">
  </tr>

  <tr mat-footer-row *matFooterRowDef="calcDisplayedColumns()"></tr>

  <tr mat-footer-row *matFooterRowDef="['disclaimer']"></tr>
</table>

<mat-paginator #aggregatesPaginator
               [length]="aggregates.totalElements"
               [pageSize]="aggregatePageSize"
               [showFirstLastButtons]="true">
</mat-paginator>
