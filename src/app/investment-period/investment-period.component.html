<mat-spinner *ngIf="isLoadingResults"></mat-spinner>

<table mat-table [dataSource]="investmentPeriods"
       matSort matSortActive="stock"
       matSortDisableClear
       matSortDirection="asc"
       class="mat-table mat-elevation-z8">

  <ng-container matColumnDef="stock" sticky>
    <th mat-header-cell *matHeaderCellDef rowspan="2">Mã</th>
    <td mat-cell *matCellDef="let row"><b>{{row.stock.code}}</b></td>
  </ng-container>

  <ng-container matColumnDef="buyColumns">
    <th mat-header-cell *matHeaderCellDef colspan="4">Giao dịch mua</th>
  </ng-container>

  <ng-container matColumnDef="sellColumns">
    <th mat-header-cell *matHeaderCellDef colspan="5">Giao dịch bán</th>
  </ng-container>

  <ng-container matColumnDef="holdColumns">
    <th mat-header-cell *matHeaderCellDef colspan="2">Đang giữ</th>
  </ng-container>

  <ng-container matColumnDef="revenueColumns">
    <th mat-header-cell *matHeaderCellDef colspan="3">Lợi nhuận</th>
  </ng-container>

  <ng-container matColumnDef="tradingTimeColumns">
    <th mat-header-cell *matHeaderCellDef colspan="3">Thời gian đầu tư</th>
  </ng-container>

  <ng-container matColumnDef="buyQuantity">
    <th mat-header-cell *matHeaderCellDef>KL</th>
    <td mat-cell *matCellDef="let row">{{row.buyQuantity | number}}</td>
  </ng-container>

  <ng-container matColumnDef="buyAvgPrice">
    <th mat-header-cell *matHeaderCellDef>Giá</th>
    <td mat-cell *matCellDef="let row">{{row.buyAvgPrice | number}}</td>
  </ng-container>

  <ng-container matColumnDef="buyFee">
    <th mat-header-cell *matHeaderCellDef>Phí</th>
    <td mat-cell *matCellDef="let row">{{row.buyFee | number}}</td>
  </ng-container>

  <ng-container matColumnDef="buyMoney">
    <th mat-header-cell *matHeaderCellDef>Vốn</th>
    <td mat-cell *matCellDef="let row">{{row.buyMoney | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellQuantity">
    <th mat-header-cell *matHeaderCellDef>KL</th>
    <td mat-cell *matCellDef="let row">{{row.sellQuantity | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellAvgPrice">
    <th mat-header-cell *matHeaderCellDef>Giá</th>
    <td mat-cell *matCellDef="let row">{{row.sellAvgPrice | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellFee">
    <th mat-header-cell *matHeaderCellDef>Phí</th>
    <td mat-cell *matCellDef="let row">{{row.sellFee | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellTax">
    <th mat-header-cell *matHeaderCellDef>Thuế</th>
    <td mat-cell *matCellDef="let row">{{row.sellTax | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellMoney">
    <th mat-header-cell *matHeaderCellDef>Tiền</th>
    <td mat-cell *matCellDef="let row">{{row.sellMoney | number}}</td>
  </ng-container>

  <ng-container matColumnDef="holdQuantity">
    <th mat-header-cell *matHeaderCellDef>KL</th>
    <td mat-cell *matCellDef="let row">{{calculateHoldQuantity(row) | number}}</td>
  </ng-container>

  <ng-container matColumnDef="holdMoney">
    <th mat-header-cell *matHeaderCellDef>Tiền</th>
    <td mat-cell *matCellDef="let row">{{calculateHoldMoney(row) | number}}</td>
  </ng-container>

  <ng-container matColumnDef="rawRevenue">
    <th mat-header-cell *matHeaderCellDef>Lãi/lỗ thuần</th>
    <td mat-cell *matCellDef="let row">{{0 | number}}</td>
  </ng-container>

  <ng-container matColumnDef="realRevenue">
    <th mat-header-cell *matHeaderCellDef>Lãi/lỗ thực</th>
    <td mat-cell *matCellDef="let row">{{0 | number}}</td>
  </ng-container>

  <ng-container matColumnDef="revenueRate">
    <th mat-header-cell *matHeaderCellDef>% lãi/lỗ</th>
    <td mat-cell *matCellDef="let row">{{0 | number}}</td>
  </ng-container>

  <ng-container matColumnDef="startedOn">
    <th mat-header-cell *matHeaderCellDef>Bắt đầu</th>
    <td mat-cell *matCellDef="let row">{{row.startedOn | date}}</td>
  </ng-container>

  <ng-container matColumnDef="endedOn">
    <th mat-header-cell *matHeaderCellDef>Kết thúc</th>
    <td mat-cell *matCellDef="let row">{{row.endedOn | date}}</td>
  </ng-container>

  <ng-container matColumnDef="totalPeriod">
    <th mat-header-cell *matHeaderCellDef>Thời gian</th>
    <td mat-cell *matCellDef="let row">{{calculateTotalDays(row) | number}}</td>
  </ng-container>

  <ng-container matColumnDef="disclaimer">
    <td mat-footer-cell *matFooterCellDef colspan="18">
      <ul>
        <li><b>Giá mua</b>/<b>giá bán</b> được tính giá trị trung bình trên toàn bộ giao dịch mua/bán của phiên đầu tư</li>
        <li><b>Tiền còn lại</b> được tính dự kiến theo giá bán hiện tại</li>
        <li><b>Lãi/lỗ thuần</b> được tính dựa trên giao dịch bán, không tính cổ tức</li>
        <li><b>Lãi/lỗ thực</b> được tính dựa trên giao dịch bán và tính cổ tức</li>
      </ul>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="['stock', 'buyColumns', 'sellColumns', 'holdColumns', 'revenueColumns', 'tradingTimeColumns']"></tr>

  <tr mat-header-row *matHeaderRowDef="displayedHeaderColumns"></tr>

  <tr mat-row *matRowDef="let row; columns: displayedValueColumns;"></tr>

  <tr mat-footer-row *matFooterRowDef="['disclaimer']"></tr>
</table>

<mat-paginator [length]="resultsLength" [pageSize]="pageSize" [showFirstLastButtons]="true"></mat-paginator>
