<mat-spinner *ngIf="isLoadingResults"></mat-spinner>

<table mat-table [dataSource]="investmentPeriods"
       matSort matSortActive="stock"
       matSortDisableClear
       matSortDirection="asc"
       class="mat-table mat-elevation-z8">

  <ng-container matColumnDef="stock">
    <th mat-header-cell *matHeaderCellDef rowspan="2">Mã</th>
    <td mat-cell *matCellDef="let row">{{row.stock.code}}</td>
  </ng-container>

  <ng-container matColumnDef="buyColumns">
    <th mat-header-cell *matHeaderCellDef colspan="4">Giao dịch mua</th>
  </ng-container>

  <ng-container matColumnDef="sellColumns">
    <th mat-header-cell *matHeaderCellDef colspan="5">Giao dịch bán</th>
  </ng-container>

  <ng-container matColumnDef="remainColumns">
    <th mat-header-cell *matHeaderCellDef colspan="5">Khác</th>
  </ng-container>

  <ng-container matColumnDef="buyQuantity">
    <th mat-header-cell *matHeaderCellDef>KL mua</th>
    <td mat-cell *matCellDef="let row">{{row.buyQuantity | number}}</td>
  </ng-container>

  <ng-container matColumnDef="buyAvgPrice">
    <th mat-header-cell *matHeaderCellDef>Giá mua</th>
    <td mat-cell *matCellDef="let row">{{row.buyAvgPrice | number}}</td>
  </ng-container>

  <ng-container matColumnDef="buyFee">
    <th mat-header-cell *matHeaderCellDef>Phí mua</th>
    <td mat-cell *matCellDef="let row">{{row.buyFee | number}}</td>
  </ng-container>

  <ng-container matColumnDef="buyMoney">
    <th mat-header-cell *matHeaderCellDef>Vốn</th>
    <td mat-cell *matCellDef="let row">{{row.buyMoney | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellQuantity">
    <th mat-header-cell *matHeaderCellDef>KL bán</th>
    <td mat-cell *matCellDef="let row">{{row.sellQuantity | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellAvgPrice">
    <th mat-header-cell *matHeaderCellDef>Giá bán</th>
    <td mat-cell *matCellDef="let row">{{row.sellAvgPrice | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellFee">
    <th mat-header-cell *matHeaderCellDef>Phí bán</th>
    <td mat-cell *matCellDef="let row">{{row.sellFee | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellTax">
    <th mat-header-cell *matHeaderCellDef>Thuế TNCN</th>
    <td mat-cell *matCellDef="let row">{{row.sellTax | number}}</td>
  </ng-container>

  <ng-container matColumnDef="sellMoney">
    <th mat-header-cell *matHeaderCellDef>Tiền bán</th>
    <td mat-cell *matCellDef="let row">{{row.sellMoney | number}}</td>
  </ng-container>

  <ng-container matColumnDef="remainQuantity">
    <th mat-header-cell *matHeaderCellDef>KL còn lại</th>
    <td mat-cell *matCellDef="let row">{{calculateRemainQuantity(row) | number}}</td>
  </ng-container>

  <ng-container matColumnDef="remainMoney">
    <th mat-header-cell *matHeaderCellDef>Tiền còn lại</th>
    <td mat-cell *matCellDef="let row">{{calculateRemainMoney(row) | number}}</td>
  </ng-container>

  <ng-container matColumnDef="startedOn">
    <th mat-header-cell *matHeaderCellDef>Ngày bắt đầu</th>
    <td mat-cell *matCellDef="let row">{{row.startedOn | date}}</td>
  </ng-container>

  <ng-container matColumnDef="endedOn">
    <th mat-header-cell *matHeaderCellDef>Ngày kết thúc</th>
    <td mat-cell *matCellDef="let row">{{row.endedOn | date}}</td>
  </ng-container>

  <ng-container matColumnDef="totalPeriod">
    <th mat-header-cell *matHeaderCellDef>Thời gian</th>
    <td mat-cell *matCellDef="let row">{{calculateTotalDays(row) | number}}</td>
  </ng-container>

  <ng-container matColumnDef="disclaimer">
    <td mat-footer-cell *matFooterCellDef colspan="15">
      <ul>
        <li><b>Giá mua</b>/<b>giá bán</b> được tính giá trị trung bình trên toàn bộ giao dịch mua/bán của phiên đầu tư</li>
        <li><b>Tiền còn lại</b> được tính dự kiến theo giá bán hiện tại</li>
      </ul>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="['stock', 'buyColumns', 'sellColumns', 'remainColumns']"></tr>

  <tr mat-header-row *matHeaderRowDef="displayedHeaderColumns"></tr>

  <tr mat-row *matRowDef="let row; columns: displayedValueColumns;"></tr>

  <tr mat-footer-row *matFooterRowDef="['disclaimer']"></tr>
</table>

<mat-paginator [length]="resultsLength" [pageSize]="pageSize" [showFirstLastButtons]="true"></mat-paginator>
